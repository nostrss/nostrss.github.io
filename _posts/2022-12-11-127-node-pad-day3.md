---
layout: post
title: '[ì›”ê°„ì½”ë”©] #3 React-Query'
author: 'Nostrss'
comments: true
tags: react typescript firebase
excerpt_separator:
sticky:
hidden:
---

## React Queryë€?

- í´ë¼ì´ì–¸íŠ¸ ìƒíƒœê´€ë¦¬ : redux, recoil ë“±
- ì„œë²„ ìƒíƒœê´€ë¦¬ : react-query

ë‹¨ìˆœì´ ì´ë ‡ê²Œ ì•Œê³  ìˆì—ˆë‹¤. ê·¸ëŸ°ë° ê³µì‹ë¬¸ì„œë¥¼ ë³´ë©´ì„œ ì˜¤ëŠ˜ ì¨ë³´ë‹ˆ ì´ê²Œ ì™ ê±¸?

ì¡°ê¸ˆ ë” ê³µë¶€í•´ì•¼ê² ì§€ë§Œ api í†µì‹ ì˜ ê´€ë¦¬ê°€ ì´ë ‡ê²Œ ì‰½ê²Œ ë˜ëŠ” ê±´ê°€ ì‹¶ì—ˆë‹¤.

axiosë¡œ í†µì‹ ì„ í•˜ê³  ë‚œ ë’¤ì— ë¡œë”©ì¤‘ì¸ì§€, ë¡œë”©ì´ ëë‚˜ë©´ thenìœ¼ë¡œ ë¬´ì—‡ì„ í• ì§€, ë°ì´í„° ìƒˆë¡œê³ ì¹¨ì„ ì¼ì¼ì´

ë‚´ê°€ ë‹¤ ë§Œë“¤ì–´ì¤˜ì•¼ í–ˆëŠ”ë° ì´ëŸ° ê±¸ ì „ë¶€ ì œê³µí•œë‹¤. ğŸ˜ğŸ˜ğŸ˜ ì²«ë‚ ì´ì§€ë§Œ ë§ˆìŒì— ì™ë“œëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë‹¤.

ì—¬ê¸°ì— ë¬´í•œìŠ¤í¬ë¡¤, í˜ì´ì§€ë„¤ì´ì…˜ì„ ë•ëŠ” ê¸°ëŠ¥ê³¼ Optimistic update ê¸°ëŠ¥ë„ ìˆëŠ” ê²ƒ ê°™ë‹¤. ë‚˜ì¤‘ì— ê¼­ ì‚¬ìš©í•´ ë´ì•¼ê² ë‹¤.

ëŒ€ì²´ì ìœ¼ë¡œ ì‚¬ìš©ë²•ì€ ë§ˆì¹˜ ì˜ˆì „ì— Apollo Clientë¡œ gqlì„ ì“¸ë•Œì™€ ë¹„ìŠ·í•œ ëŠë‚Œì´ë‹¤.

## QueryClientProvider ì„¤ì •í•˜ê¸°

```javascript
// index.tsx íŒŒì¼
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';

const root = ReactDOM.createRoot(
  document.getElementById('root') as HTMLElement
);

const queryClient = new QueryClient();

root.render(
  <React.StrictMode>
    <ThemeProvider theme={theme}>
      <GlobalStyle />
      <QueryClientProvider client={queryClient}>
        <Layout>
          <App />
        </Layout>
      </QueryClientProvider>
    </ThemeProvider>
  </React.StrictMode>
);
```

## useQuery ì‚¬ìš©ë²•

- apië¥¼ getí•  ë–„ ì‚¬ìš©í•œë‹¤.

### import useQuery

> import { useQuery } from '@tanstack/react-query';

### Query Functions

[Query Functions ê³µì‹ë¬¸ì„œ](https://tanstack.com/query/v4/docs/guides/query-functions)

```javascript
useQuery({
  queryKey : ['ì¿¼ë¦¬í‚¤'],
  queryFn : fetch ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ í•¨ìˆ˜
})
```

ì‘ë‹µê°’ì˜ ì¢…ë¥˜

- data : fetchë¡œ ë°›ì€ ì •ë³´
- isLoading : í†µì‹  ì™„ë£Œ ê°’, then ë˜ëŠ” status 200ìœ¼ë¡œ ìƒê°í•˜ë©´ ë ë“¯
- refetch : ë™ì¼í•œ ì¿¼ë¦¬í‚¤ì˜ useQueryë¥¼ ì¬ì‹¤í–‰í•˜ëŠ” í•¨ìˆ˜

ë‚˜ë¨¸ì§€ëŠ” ê³µì‹ ë¬¸ì„œì—ì„œ ë” ê³µë¶€í•´ë³´ì

### ì˜ˆì‹œ

ë‚˜ëŠ” ì•„ë˜ì™€ ê°™ì´ ì‚¬ìš©í–ˆê³  ê²°ê³¼ ê°’ì„ êµ¬ì¡°ë¶„í•´ í• ë‹¹í•˜ì—¬ `memoLists`, `isFetching`, `refetch`ë¡œ ë‹´ì•„ ì‚¬ìš©í–ˆë‹¤.

```javascript
import { useQuery } from '@tanstack/react-query';
import { loadMemoList } from 'common/util';
import { firebaseDb } from 'App';

const {
  data: memoLists,
  isLoading: isFetching,
  refetch,
} = useQuery({
  queryKey: ['fetchdata'],
  queryFn: async () => loadMemoList(firebaseDb, 'no-sign-in'),
});
```

## useMutation ì‚¬ìš©ë²•

mutationì€ ì‚¬ìš©ë²•ì—ì„œ ì¡°ê¸ˆ í—¤ë©¨ë‹¤. ì•„ì§ë„ ì¡°ê¸ˆ í—·ê°ˆë¦¬ëŠ” ë¶€ë¶„ì´ ìˆëŠ”ë° ì´í•´í•œ ë¶€ë¶„ê¹Œì§€ ì •ë¦¬ë¥¼ í•´ë³´ë©´ ì•„ë˜ì™€ ê°™ë‹¤.

```javascript
import { useMutation } from '@tanstack/react-query';

const { mutate } = useMutation({
  mutationFn: Mutaioní•¨ìˆ˜,
});
```

ìœ„ì™€ ê°™ì´ mutateë¥¼ ì„ ì–¸í•´ì£¼ê³  ì•„ë˜ì²˜ëŸ¼ ë²„íŠ¼ ë“±ì— ë°”ì¸ë”© í•´ì„œ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

```javascript
<button
  onClick={() => {
    mutate({ id: new Date(), title: 'Do Laundry' })
    }}
    >
```

### ì‹¤ì œ ì‚¬ìš©í•œ ì½”ë“œ

```javascript

interface INewTite {
  text: string;
  createdAt: any;
}

import { useMutation } from '@tanstack/react-query';

export default function SideBar() {

  const { mutate: createTitle, isLoading: isMutating } = useMutation(
    (newTitle: INewTite) => {
      return addDoc(collection(firebaseDb, 'no-sign-in'), newTitle);
    }
  );

  const onSubmitMemoTitle = async (event: React.SyntheticEvent) => {
    event.preventDefault();
    const memoObj = {
      text: memoTitle,
      createdAt: serverTimestamp(),
    };

    createTitle(memoObj);
    refetch(); // useQueryë¡œ ë°›ì•„ì˜¨ refetch í•¨ìˆ˜ì´ë‹¤.
    setMemoTitle('');
  };
.
}
```

ëª‡ ì‹œê°„ ì•ˆì¨ë´¤ì§€ë§Œ ë‹¹ì¥ íšŒì‚¬ì—ì„œë„ ì“¸ ìˆ˜ ìˆìœ¼ë©´ ì¢‹ê² ë‹¤...ë¼ëŠ” ë§ˆìŒì´ ë“¤ê²Œ í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë‹¤.
